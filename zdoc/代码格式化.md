# 代码风格  
[Google Java Style Guide](https://google.github.io/styleguide/javaguide.html)

# 代码格式化

项目中集成了maven spotless插件，并且做强制编译检查，如果代码格式化不正确，编译会不通过。

使用的代码规范为

```
<configuration>
    <java>
        <!-- These are the defaults, you can override if you want -->
        <includes>
            <include>src/main/java/**/*.java</include>
            <include>src/test/java/**/*.java</include>
        </includes>

        <importOrder/> <!-- standard import order -->
        <removeUnusedImports/> <!-- self-explanatory -->

        <googleJavaFormat>
            <version>1.7</version> <!-- optional -->
            <style>AOSP</style>  <!-- or AOSP (optional) -->
        </googleJavaFormat>
    </java>
</configuration>

```

强制检查配置

```
<executions>
    <execution>
        <!-- Runs in compile phase to fail fast in case of formatting issues.-->
        <id>spotless-check</id>
        <phase>compile</phase>
        <goals>
            <goal>check</goal>
        </goals>
</execution>
```

**注意：windows上请执行如下命令配置git，让git在你提交时，自动地把行结束符 CRLF 转换成 LF，而在签出代码时把 LF 转换成 CRLF 。**
**这样可以保证格式化出来的代码在与linux下相同。**

`git config --global core.autocrlf true`

有两种方式执行代码格式化：手动方式和自动方式。

## 手动执行

提交完代码后，手动执行`mvn spotless:check`检查规范，手动执行`mvn spotless:apply`应用规范，应用规范会改变对应的文件并放在git工作区，需要手动commit。

## 自动执行
[pre-commit](https://pre-commit.com/)
自动执行的原理是应用pre-commit钩子，在push代码之前执行`mvn spotless:check`和`mvn spotless:apply`。
项目中已经配置pre-commit文件（根目录下.pre-commit-config.yaml），本地拉取代码后，执行以下安装：

```
(mac) brew install pre-commit
or
(windows on condition python3 isntalled) pip3 install pre-commit
```

再执行以下命令安装钩子：

```
pre-commit install --install-hooks -t pre-push
```

后续在push代码之前会自动执行检查和应用规范（当然应用规范改变的对应文件放在git工作区，还是需要手动commit。）