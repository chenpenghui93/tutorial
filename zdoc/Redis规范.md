# Redis规范
以下规范为强制要求，code review时若发现不符合规范需要重新修改   
- 命名统一使用小写字母，以冒号分隔   
  例：token:refresh:lock  
- 避免不必要的Exists操作   
  Redis与MySQL等关系型数据库不同，很多操作自带了判断数据是否存在的功能，例如setnx、del等指令。因而许多情况下无需先Exists查询数据是否存在后再执行操作，直接执行操作即可，可节省一半的网络请求  
- 释放分布式锁前，判断是否是自己加的锁，避免误释放  
- 需要单机执行的定时任务，抢锁后不要释放锁  
  避免定时任务执行太快，锁释放的速度比多台机器的接收到redis publish消息的时间差还快，导致多台机器同时执行定时任务  
- 获取Jedis后必须主动归还资源  
  JedisTemplate中大部分的Redis操作自带了归还功能，此时无需手动归还资源；当使用JedisTemplate中未包含的方法(如TTL等)时，需要手动获取Jedis以执行这些方法，此时务必记得归还资源，否则资源无法回收会出现连接池打满的异常  
- 分布式锁的超时时间不得小于该方法可能的最长执行时间  
  例：执行方法中包含http调用，则该锁的超时时间必须大于http调用设置的超时时间  
- 分布式锁的执行方法如果包含循环，无法判定最长执行时间，则需要进行锁续期  
- 谨慎使用时间复杂度为O(n)的命令  
  keys、hgetall、lrange、smembers、zrange等命令，使用时必须关注n的大小，避免数量过多的值打爆内存  
- 注意value的大小，禁止保存过大的内容  
  benchmark的结果是value值的大小超过10KB，就会对性能有较大损害  
- Redis中不要保存永久数据，必须设定过期时间  
  Redis只用来存储缓存、Token这些临时数据，这些数据必须设置过期时间，第一，可以避免随着时间推移，内存中存储大量失效的数据；第二，一旦缓存和数据库中的数据由于程序bug发生不一致的情况，设置过期时间至少可以保证key过期之后可以达到最终一致性  
